{% extends 'base.html' %}

{% block title %}Dashboard - LanfiaSave{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-heart"></i>
                <span>LanfiaSave</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <!-- Dashboard Principal -->
            <div class="nav-section">
                <a href="#" class="nav-item active" onclick="showContent('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{% url 'profile' %}" class="nav-item">
                    <i class="fas fa-user"></i>
                    <span>Profil</span>
                </a>
            </div>

            {% if user.is_donator %}
            <!-- Menu Donateur -->
            <div class="nav-section">
                <div class="nav-title">Actions Donateur</div>
                <a href="{% url 'donation_view' %}" class="nav-item">
                    <i class="fas fa-donate"></i>
                    <span>Faire un Don</span>
                </a>
                <a href="{% url 'historique_dons' %}" class="nav-item">
                    <i class="fas fa-history"></i>
                    <span>Historique</span>
                </a>
                <a href="{% url 'mes_dons_en_attente' %}" class="nav-item">
                    <i class="fas fa-clock"></i>
                    <span>Dons en Attente</span>
                    {% if dons_en_attente %}
                        <span class="badge">{{ dons_en_attente }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'dashboard_donateur' %}" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Statistiques</span>
                </a>
            </div>
            
            <!-- Formations pour Donateur -->
            <div class="nav-section">
                <div class="nav-title">Formations (Consultation)</div>
                <a href="{% url 'formation:formations_list' %}" class="nav-item">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Voir Formations</span>
                </a>
                <a href="{% url 'formation:rapports_formation' %}" class="nav-item">
                    <i class="fas fa-chart-pie"></i>
                    <span>Impact Formations</span>
                </a>
            </div>

            {% elif user.is_vulnerable %}
            <!-- Menu Personne Vulnérable -->
            <div class="nav-section">
                <div class="nav-title">Mon Espace</div>
                <a href="{% url 'voir_retirer_dons' %}" class="nav-item">
                    <i class="fas fa-gift"></i>
                    <span>Mes Dons</span>
                </a>
                <a href="#" class="nav-item" onclick="showContent('progression')">
                    <i class="fas fa-chart-line"></i>
                    <span>Ma Progression</span>
                </a>
            </div>

            <!-- Formations pour Personne Vulnérable -->
            <div class="nav-section">
                <div class="nav-title">Mes Formations</div>
                <a href="{% url 'formation:formations_list' %}" class="nav-item">
                    <i class="fas fa-search"></i>
                    <span>Parcourir Formations</span>
                </a>
                <a href="{% url 'formation:mes_demandes' %}" class="nav-item">
                    <i class="fas fa-file-alt"></i>
                    <span>Mes Demandes</span>
                    {% if demandes_formation_count %}
                        <span class="badge">{{ demandes_formation_count }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'formation:mon_parcours' %}" class="nav-item">
                    <i class="fas fa-route"></i>
                    <span>Mon Parcours</span>
                </a>
                <a href="{% url 'formation:mes_projets' %}" class="nav-item">
                    <i class="fas fa-project-diagram"></i>
                    <span>Mes Projets</span>
                    {% if projets_vie_count %}
                        <span class="badge">{{ projets_vie_count }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'formation:projet_vie_create' %}" class="nav-item">
                    <i class="fas fa-lightbulb"></i>
                    <span>Créer Projet</span>
                </a>
                <a href="{% url 'formation:mes_analyses_ia' %}" class="nav-item">
                    <i class="fas fa-brain"></i>
                    <span>Analyses IA</span>
                </a>
            </div>

            {% elif user.is_recenseur %}
            <!-- Menu Recenseur -->
            <div class="nav-section">
                <div class="nav-title">Recensement</div>
                <a href="{% url 'recenser_personne' %}" class="nav-item">
                    <i class="fas fa-user-plus"></i>
                    <span>Nouveau Recensement</span>
                </a>
                <a href="{% url 'liste_personnes_recensees' %}" class="nav-item">
                    <i class="fas fa-list"></i>
                    <span>Mes Recensements</span>
                    <span class="badge">{{ user.personnes_recensees.count }}</span>
                </a>
                <a href="#" class="nav-item" onclick="showContent('stats-recenseur')">
                    <i class="fas fa-chart-pie"></i>
                    <span>Statistiques</span>
                </a>
            </div>

            <!-- Formations pour Recenseur -->
            <div class="nav-section">
                <div class="nav-title">Formations (Consultation)</div>
                <a href="{% url 'formation:formations_list' %}" class="nav-item">
                    <i class="fas fa-eye"></i>
                    <span>Voir Formations</span>
                </a>
                <a href="{% url 'formation:rapports_formation' %}" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Rapports</span>
                </a>
            </div>

            {% elif user.is_superuser %}
            <!-- Menu Administrateur -->
            <div class="nav-section">
                <div class="nav-title">Administration</div>
                <a href="{% url 'admin_dashboard' %}" class="nav-item">
                    <i class="fas fa-cogs"></i>
                    <span>Panel Admin</span>
                </a>
                <a href="{% url 'admin_personnes_carousel' %}" class="nav-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Validation</span>
                    {% if personnes_a_valider %}
                        <span class="badge">{{ personnes_a_valider }}</span>
                    {% endif %}
                </a>
                <a href="#" class="nav-item" onclick="showContent('users-management')">
                    <i class="fas fa-users"></i>
                    <span>Gestion Utilisateurs</span>
                </a>
            </div>

            <!-- Administration Formations -->
            <div class="nav-section">
                <div class="nav-title">Admin Formations</div>
                <a href="{% url 'formation:admin_dashboard' %}" class="nav-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard Formations</span>
                </a>
                <a href="{% url 'formation:admin_formations_manage' %}" class="nav-item">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Gérer Formations</span>
                </a>
                <a href="{% url 'formation:admin_formation_create' %}" class="nav-item">
                    <i class="fas fa-plus"></i>
                    <span>Créer Formation</span>
                </a>
                <a href="{% url 'formation:admin_demandes_list' %}" class="nav-item">
                    <i class="fas fa-inbox"></i>
                    <span>Demandes</span>
                    {% if demandes_en_attente %}
                        <span class="badge">{{ demandes_en_attente }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'formation:admin_parcours_list' %}" class="nav-item">
                    <i class="fas fa-route"></i>
                    <span>Parcours</span>
                </a>
                <a href="{% url 'formation:admin_projets_list' %}" class="nav-item">
                    <i class="fas fa-project-diagram"></i>
                    <span>Projets Vie</span>
                </a>
            </div>

            <!-- Analyses IA Admin -->
            <div class="nav-section">
                <div class="nav-title">IA & Analytics</div>
                <a href="{% url 'formation:analyses_ia_dashboard' %}" class="nav-item">
                    <i class="fas fa-brain"></i>
                    <span>Dashboard IA</span>
                </a>
                <a href="{% url 'formation:admin_configuration_ia' %}" class="nav-item">
                    <i class="fas fa-cogs"></i>
                    <span>Config IA</span>
                </a>
                <a href="{% url 'formation:export_demandes_csv' %}" class="nav-item">
                    <i class="fas fa-download"></i>
                    <span>Export Données</span>
                </a>
            </div>
            {% endif %}

            <!-- Menu commun -->
            <div class="nav-section">
                <div class="nav-title">Général</div>
                <a href="{% url 'notifications' %}" class="nav-item">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                    {% if notifications_count %}
                        <span class="badge">{{ notifications_count }}</span>
                    {% endif %}
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Paramètres</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-question-circle"></i>
                    <span>Aide</span>
                </a>
            </div>
        </nav>

        <div class="sidebar-footer">
            {% if not user.is_superuser %}
            <a href="#" class="upgrade-btn">
                <i class="fas fa-star"></i>
                <span>Upgrade to Pro</span>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="content-header">
            <div class="header-left">
                <h1 id="page-title">DASHBOARD</h1>
                <nav class="breadcrumb">
                    <span>Dashboard</span>
                    <span class="breadcrumb-separator">/</span>
                    <span id="breadcrumb-current">Vue d'ensemble</span>
                </nav>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher...">
                </div>
                <div class="notifications-btn" onclick="toggleNotifications()">
                    <i class="fas fa-bell"></i>
                    {% if notifications_count %}
                        <span class="notification-dot">{{ notifications_count }}</span>
                    {% endif %}
                </div>
                <div class="user-menu" onclick="toggleUserMenu()">
                    <div class="user-avatar">
                        {{ user.username|first|upper }}
                    </div>
                    <div class="user-info">
                        <span class="user-name">{{ user.username|title }}</span>
                        <span class="user-role">
                            {% if user.is_superuser %}Administrateur
                            {% elif user.is_donator %}Donateur
                            {% elif user.is_vulnerable %}Bénéficiaire
                            {% elif user.is_recenseur %}Recenseur
                            {% else %}Membre{% endif %}
                        </span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <div class="content-body">
            
            <!-- Dashboard Overview -->
            <div id="dashboard-content" class="content-section active">
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h2>Actions Rapides</h2>
                    <div class="actions-grid">
                        {% if user.is_donator %}
                            <a href="{% url 'donation_view' %}" class="action-card primary">
                                <div class="action-icon">
                                    <i class="fas fa-donate"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Faire un Don</h3>
                                    <p>Aider les personnes vulnérables</p>
                                </div>
                            </a>
                            <a href="{% url 'formation:formations_list' %}" class="action-card secondary">
                                <div class="action-icon">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Voir Formations</h3>
                                    <p>Impact des formations</p>
                                </div>
                            </a>

                        {% elif user.is_vulnerable %}
                            <a href="{% url 'formation:formations_list' %}" class="action-card primary">
                                <div class="action-icon">
                                    <i class="fas fa-search"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Parcourir Formations</h3>
                                    <p>Trouvez votre formation idéale</p>
                                </div>
                            </a>
                            <a href="{% url 'formation:projet_vie_create' %}" class="action-card success">
                                <div class="action-icon">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Créer un Projet</h3>
                                    <p>Planifiez votre projet de vie</p>
                                </div>
                            </a>
                            <a href="{% url 'voir_retirer_dons' %}" class="action-card warning">
                                <div class="action-icon">
                                    <i class="fas fa-gift"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Mes Dons</h3>
                                    <p>Voir et retirer les dons</p>
                                </div>
                            </a>

                        {% elif user.is_recenseur %}
                            <a href="{% url 'recenser_personne' %}" class="action-card primary">
                                <div class="action-icon">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Nouveau Recensement</h3>
                                    <p>Recenser une personne</p>
                                </div>
                            </a>
                            <a href="{% url 'formation:formations_list' %}" class="action-card info">
                                <div class="action-icon">
                                    <i class="fas fa-eye"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Consulter Formations</h3>
                                    <p>Orienter les bénéficiaires</p>
                                </div>
                            </a>

                        {% elif user.is_superuser %}
                            <a href="{% url 'formation:admin_dashboard' %}" class="action-card primary">
                                <div class="action-icon">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Admin Formations</h3>
                                    <p>Gérer les formations</p>
                                </div>
                            </a>
                            <a href="{% url 'formation:admin_formation_create' %}" class="action-card success">
                                <div class="action-icon">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Créer Formation</h3>
                                    <p>Nouvelle formation</p>
                                </div>
                            </a>
                            <a href="{% url 'admin_personnes_carousel' %}" class="action-card warning">
                                <div class="action-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="action-content">
                                    <h3>Validation</h3>
                                    <p>Valider les recensements</p>
                                </div>
                            </a>
                        {% endif %}
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    {% if user.is_donator %}
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>TOTAL DONS</h3>
                                <div class="stat-trend positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+{{ new_donations|default:"0" }}</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ total_donations|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart1" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>MONTANT TOTAL</h3>
                                <div class="stat-trend positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+{{ recent_amount|default:"0" }}€</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ total_amount|default:"0" }}€</div>
                                <div class="stat-chart">
                                    <canvas id="chart2" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>VIES TOUCHÉES</h3>
                                <div class="stat-trend positive">
                                    <i class="fas fa-heart"></i>
                                    <span>Impact</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ beneficiaires|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart3" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>

                    {% elif user.is_vulnerable %}
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>FORMATIONS</h3>
                                <div class="stat-trend neutral">
                                    <i class="fas fa-graduation-cap"></i>
                                    <span>Disponibles</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ formations_disponibles|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart1" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>MES DEMANDES</h3>
                                <div class="stat-trend neutral">
                                    <i class="fas fa-file-alt"></i>
                                    <span>En cours</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ demandes_formation_count|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart2" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>PROJETS VIE</h3>
                                <div class="stat-trend positive">
                                    <i class="fas fa-project-diagram"></i>
                                    <span>Actifs</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ projets_vie_count|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart3" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>

                    {% elif user.is_recenseur %}
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>RECENSEMENTS</h3>
                                <div class="stat-trend positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+{{ new_recensements|default:"0" }}</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ user.personnes_recensees.count }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart1" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>VALIDÉES</h3>
                                <div class="stat-trend positive">
                                    <i class="fas fa-check-circle"></i>
                                    <span>{{ taux_validation|default:"0" }}%</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ validees|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart2" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>EN ATTENTE</h3>
                                <div class="stat-trend warning">
                                    <i class="fas fa-clock"></i>
                                    <span>À valider</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ en_attente|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart3" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>

                    {% else %}
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>FORMATIONS ACTIVES</h3>
                                <div class="stat-trend positive">
                                    <i class="fas fa-graduation-cap"></i>
                                    <span>Disponibles</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ formations_actives|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart1" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>DEMANDES FORMATION</h3>
                                <div class="stat-trend warning">
                                    <i class="fas fa-inbox"></i>
                                    <span>En attente</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ demandes_en_attente|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart2" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <h3>PARCOURS EN COURS</h3>
                                <div class="stat-trend positive">
                                    <i class="fas fa-route"></i>
                                    <span>Actifs</span>
                                </div>
                            </div>
                            <div class="stat-body">
                                <div class="stat-value">{{ parcours_en_cours|default:"0" }}</div>
                                <div class="stat-chart">
                                    <canvas id="chart3" width="100" height="40"></canvas>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- Main Chart Section -->
                <div class="chart-section">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h2>
                                {% if user.is_donator %}
                                    ÉVOLUTION DE VOS DONS ET IMPACT FORMATIONS
                                {% elif user.is_vulnerable %}
                                    PROGRESSION FORMATIONS ET PROJETS DE VIE
                                {% elif user.is_recenseur %}
                                    RECENSEMENTS ET ORIENTATIONS FORMATIONS
                                {% else %}
                                    ACTIVITÉ GLOBALE FORMATIONS
                                {% endif %}
                            </h2>
                            <div class="chart-controls">
                                <select class="chart-filter">
                                    <option value="12">12 derniers mois</option>
                                    <option value="6">6 derniers mois</option>
                                    <option value="3">3 derniers mois</option>
                                </select>
                                <div class="chart-legend">
                                    {% if user.is_donator %}
                                        <span class="legend-item">
                                            <span class="legend-color" style="background: #4f46e5;"></span>
                                            Dons
                                        </span>
                                        <span class="legend-item">
                                            <span class="legend-color" style="background: #06b6d4;"></span>
                                            Impact Formations
                                        </span>
                                    {% elif user.is_vulnerable %}
                                        <span class="legend-item">
                                            <span class="legend-color" style="background: #10b981;"></span>
                                            Formations
                                        </span>
                                        <span class="legend-item">
                                            <span class="legend-color" style="background: #f59e0b;"></span>
                                            Projets
                                        </span>
                                    {% elif user.is_recenseur %}
                                        <span class="legend-item">
                                            <span class="legend-color" style="background: #8b5cf6;"></span>
                                            Recensements
                                        </span>
                                        <span class="legend-item">
                                            <span class="legend-color" style="background: #06b6d4;"></span>
                                            Orientations
                                        </span>
                                    {% else %}
                                        <span class="legend-item">
                                            <span class="legend-color" style="background: #4f46e5;"></span>
                                            Formations
                                        </span>
                                        <span class="legend-item">
                                            <span class="legend-color" style="background: #10b981;"></span>
                                            Succès
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="mainChart" width="800" height="300"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Activity Table -->
                <div class="table-section">
                    <div class="table-container">
                        <div class="table-header">
                            <h2>
                                {% if user.is_donator %}
                                    IMPACT DE VOS DONS SUR LES FORMATIONS
                                {% elif user.is_vulnerable %}
                                    MES FORMATIONS ET PROJETS RÉCENTS
                                {% elif user.is_recenseur %}
                                    RECENSEMENTS ET ORIENTATIONS RÉCENTS
                                {% else %}
                                    ACTIVITÉ FORMATIONS RÉCENTE
                                {% endif %}
                            </h2>
                            <div class="table-actions">
                                <select class="filter-select">
                                    <option>Janvier 2025</option>
                                    <option>Décembre 2024</option>
                                    <option>Novembre 2024</option>
                                </select>
                                <button class="btn-export">
                                    <i class="fas fa-download"></i>
                                    Exporter
                                </button>
                            </div>
                        </div>
                        <div class="table-body">
                            <table>
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>
                                            {% if user.is_donator %}
                                                BÉNÉFICIAIRE/FORMATION
                                            {% elif user.is_vulnerable %}
                                                FORMATION/PROJET
                                            {% elif user.is_recenseur %}
                                                PERSONNE/ORIENTATION
                                            {% else %}
                                                FORMATION/DEMANDEUR
                                            {% endif %}
                                        </th>
                                        <th>TYPE</th>
                                        <th>STATUT</th>
                                        <th>DATE</th>
                                        <th>
                                            {% if user.is_donator %}
                                                IMPACT
                                            {% elif user.is_vulnerable %}
                                                PROGRESSION
                                            {% elif user.is_recenseur %}
                                                RÉSULTAT
                                            {% else %}
                                                ACTION
                                            {% endif %}
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if user.is_donator %}
                                        <tr>
                                            <td>1</td>
                                            <td>Marie K. - Formation Couture</td>
                                            <td><span class="type-badge formation">Formation</span></td>
                                            <td><span class="status completed">Financée</span></td>
                                            <td>15 Jan, 2025</td>
                                            <td class="impact-cell">
                                                <i class="fas fa-graduation-cap"></i>
                                                Formation complétée
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>Jean K. - Projet Agriculture</td>
                                            <td><span class="type-badge project">Projet</span></td>
                                            <td><span class="status pending">En cours</span></td>
                                            <td>14 Jan, 2025</td>
                                            <td class="impact-cell">
                                                <i class="fas fa-seedling"></i>
                                                Projet lancé
                                            </td>
                                        </tr>
                                    {% elif user.is_vulnerable %}
                                        <tr>
                                            <td>1</td>
                                            <td>Formation Couture Moderne</td>
                                            <td><span class="type-badge formation">Formation</span></td>
                                            <td><span class="status in-progress">En cours</span></td>
                                            <td>10 Jan, 2025</td>
                                            <td class="progress-cell">
                                                <div class="mini-progress">
                                                    <div class="progress-bar" style="width: 65%"></div>
                                                </div>
                                                65%
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>Projet Atelier Couture</td>
                                            <td><span class="type-badge project">Projet</span></td>
                                            <td><span class="status approved">Approuvé</span></td>
                                            <td>08 Jan, 2025</td>
                                            <td class="progress-cell">
                                                <div class="mini-progress">
                                                    <div class="progress-bar" style="width: 30%"></div>
                                                </div>
                                                Planification
                                            </td>
                                        </tr>
                                    {% elif user.is_recenseur %}
                                        <tr>
                                            <td>1</td>
                                            <td>Awa T. - Orientation Formation</td>
                                            <td><span class="type-badge orientation">Orientation</span></td>
                                            <td><span class="status completed">Orientée</span></td>
                                            <td>15 Jan, 2025</td>
                                            <td class="result-cell">
                                                <i class="fas fa-check"></i>
                                                Formation acceptée
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>Ibrahim S. - Recensement</td>
                                            <td><span class="type-badge recensement">Recensement</span></td>
                                            <td><span class="status pending">En attente</span></td>
                                            <td>14 Jan, 2025</td>
                                            <td class="result-cell">
                                                <i class="fas fa-clock"></i>
                                                Validation admin
                                            </td>
                                        </tr>
                                    {% else %}
                                        <tr>
                                            <td>1</td>
                                            <td>Formation Agriculture Moderne</td>
                                            <td><span class="type-badge formation">Formation</span></td>
                                            <td><span class="status active">Active</span></td>
                                            <td>15 Jan, 2025</td>
                                            <td class="action-cell">
                                                <button class="btn-mini view">Voir</button>
                                                <button class="btn-mini edit">Modifier</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>Demande - Marie Kouassi</td>
                                            <td><span class="type-badge demande">Demande</span></td>
                                            <td><span class="status pending">En attente</span></td>
                                            <td>14 Jan, 2025</td>
                                            <td class="action-cell">
                                                <button class="btn-mini approve">Approuver</button>
                                                <button class="btn-mini reject">Rejeter</button>
                                            </td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Autres contenus (cachés par défaut) -->
            <div id="progression-content" class="content-section">
                <div class="section-header">
                    <h2>Ma Progression Détaillée</h2>
                    <div class="section-actions">
                        <button class="btn-secondary">
                            <i class="fas fa-download"></i>
                            Télécharger Rapport
                        </button>
                    </div>
                </div>
                <!-- Contenu progression formations -->
                <div class="progression-content">
                    <div class="progress-cards">
                        <div class="progress-card">
                            <h3>Formations Complétées</h3>
                            <div class="progress-visual">
                                <div class="circular-progress" data-percentage="{{ formations_completees_pct|default:0 }}">
                                    <span>{{ formations_completees|default:0 }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="progress-card">
                            <h3>Projets Lancés</h3>
                            <div class="progress-visual">
                                <div class="circular-progress" data-percentage="{{ projets_lances_pct|default:0 }}">
                                    <span>{{ projets_lances|default:0 }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="stats-recenseur-content" class="content-section">
                <div class="section-header">
                    <h2>Statistiques Détaillées - Recensement</h2>
                </div>
                <!-- Contenu stats recenseur -->
                <div class="stats-recenseur-content">
                    <div class="charts-grid">
                        <div class="chart-widget">
                            <h3>Répartition par Catégorie</h3>
                            <canvas id="categoryChart"></canvas>
                        </div>
                        <div class="chart-widget">
                            <h3>Taux de Validation</h3>
                            <canvas id="validationChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Dropdowns -->
<div class="dropdown-overlay" onclick="closeAllDropdowns()"></div>

<!-- Notifications Dropdown -->
<div class="notifications-dropdown" id="notificationsDropdown">
    <div class="dropdown-header">
        <h3>Notifications</h3>
        <button class="mark-all-read">Tout marquer lu</button>
    </div>
    <div class="dropdown-body">
        <div class="notification-item unread">
            <div class="notification-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div class="notification-content">
                <p>Nouvelle formation disponible</p>
                <span class="notification-time">Il y a 5 min</span>
            </div>
        </div>
        <div class="notification-item">
            <div class="notification-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="notification-content">
                <p>Votre demande a été approuvée</p>
                <span class="notification-time">Il y a 1h</span>
            </div>
        </div>
    </div>
    <div class="dropdown-footer">
        <a href="{% url 'notifications' %}">Voir toutes les notifications</a>
    </div>
</div>

<!-- User Menu Dropdown -->
<div class="user-dropdown" id="userDropdown">
    <div class="dropdown-header">
        <div class="user-avatar-large">{{ user.username|first|upper }}</div>
        <div class="user-details">
            <h3>{{ user.get_full_name|default:user.username }}</h3>
            <p>{{ user.email|default:"Pas d'email" }}</p>
        </div>
    </div>
    <div class="dropdown-body">
        <a href="{% url 'profile' %}" class="dropdown-item">
            <i class="fas fa-user"></i>
            Mon Profil
        </a>
        <a href="#" class="dropdown-item">
            <i class="fas fa-cog"></i>
            Paramètres
        </a>
        <a href="#" class="dropdown-item">
            <i class="fas fa-question-circle"></i>
            Aide
        </a>
        <div class="dropdown-divider"></div>
        <a href="{% url 'logout' %}" class="dropdown-item danger">
            <i class="fas fa-sign-out-alt"></i>
            Déconnexion
        </a>
    </div>
</div>

<style>
/* Variables CSS */
:root {
    --sidebar-width: 280px;
    --header-height: 80px;
    --primary: #667eea;
    --primary-dark: #5a6fd8;
    --secondary: #764ba2;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #3b82f6;
    --light: #f8fafc;
    --dark: #1e293b;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
    --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    --gradient-info: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --radius-2xl: 20px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: var(--dark);
    line-height: 1.6;
    overflow-x: hidden;
}

/* Dashboard Container */
.dashboard-container {
    display: flex;
    min-height: 100vh;
    margin: -2.5rem;
    background: var(--gray-50);
}

/* Sidebar */
.sidebar {
    width: var(--sidebar-width);
    background: white;
    border-right: 1px solid var(--gray-200);
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    left: 0;
    top: 0;
    z-index: 1000;
    overflow-y: auto;
    box-shadow: var(--shadow-lg);
}

.sidebar-header {
    padding: 2rem 1.5rem;
    border-bottom: 1px solid var(--gray-200);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 800;
    font-size: 1.5rem;
    color: white;
    text-decoration: none;
}

.logo i {
    font-size: 2rem;
    color: white;
}

/* Navigation */
.sidebar-nav {
    flex: 1;
    padding: 1.5rem 0;
}

.nav-section {
    margin-bottom: 2rem;
}

.nav-title {
    padding: 0 1.5rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--gray-500);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    color: var(--gray-700);
    text-decoration: none;
    transition: var(--transition);
    position: relative;
    font-weight: 500;
    border-radius: 0;
}

.nav-item:hover {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
    color: var(--primary);
    transform: translateX(4px);
}

.nav-item.active {
    background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    box-shadow: var(--shadow-md);
}

.nav-item.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: white;
}

.nav-item i {
    width: 24px;
    text-align: center;
    font-size: 1.1rem;
}

.nav-item .badge {
    margin-left: auto;
    background: var(--danger);
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    min-width: 20px;
    text-align: center;
    animation: pulse 2s infinite;
}

/* Sidebar Footer */
.sidebar-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--gray-200);
}

.upgrade-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 1rem;
    background: linear-gradient(135deg, #ec4899, #be185d);
    color: white;
    text-decoration: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    transition: var(--transition);
    box-shadow: var(--shadow-md);
}

.upgrade-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

/* Main Content */
.main-content {
    flex: 1;
    margin-left: var(--sidebar-width);
    display: flex;
    flex-direction: column;
    background: var(--gray-50);
}

/* Header */
.content-header {
    height: var(--header-height);
    background: white;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: var(--shadow-sm);
}

.header-left h1 {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--dark);
    margin-bottom: 0.25rem;
    background: var(--gradient-primary);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--gray-500);
}

.breadcrumb-separator {
    color: var(--gray-300);
}

.header-right {
    display: flex;
    align-items: center;
    gap: 2rem;
}

.search-box {
    position: relative;
    display: flex;
    align-items: center;
}

.search-box i {
    position: absolute;
    left: 1rem;
    color: var(--gray-400);
    z-index: 1;
}

.search-box input {
    padding: 0.75rem 1rem 0.75rem 2.75rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-xl);
    background: var(--gray-50);
    font-size: 0.875rem;
    width: 320px;
    transition: var(--transition);
    font-weight: 500;
}

.search-box input:focus {
    outline: none;
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
}

.notifications-btn {
    position: relative;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--gray-100);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    color: var(--gray-600);
}

.notifications-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.notification-dot {
    position: absolute;
    top: 8px;
    right: 8px;
    background: var(--danger);
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid white;
    animation: pulse 2s infinite;
}

.user-menu {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 1rem;
    border-radius: var(--radius-xl);
    background: var(--gray-100);
    cursor: pointer;
    transition: var(--transition);
    border: 2px solid transparent;
}

.user-menu:hover {
    background: white;
    border-color: var(--primary);
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--gradient-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1rem;
    box-shadow: var(--shadow-md);
}

.user-info {
    display: flex;
    flex-direction: column;
}

.user-name {
    font-weight: 600;
    color: var(--dark);
    font-size: 0.875rem;
}

.user-role {
    font-size: 0.75rem;
    color: var(--gray-500);
}

/* Content Body */
.content-body {
    flex: 1;
    padding: 2rem;
    overflow-y: auto;
}

.content-section {
    display: none;
    animation: fadeIn 0.5s ease-out;
}

.content-section.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Quick Actions */
.quick-actions {
    margin-bottom: 2rem;
}

.quick-actions h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.quick-actions h2::before {
    content: '';
    width: 4px;
    height: 24px;
    background: var(--gradient-primary);
    border-radius: 2px;
}

.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
}

.action-card {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 2rem;
    background: white;
    border-radius: var(--radius-xl);
    text-decoration: none;
    transition: var(--transition);
    border: 2px solid transparent;
    box-shadow: var(--shadow-md);
    position: relative;
    overflow: hidden;
}

.action-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-primary);
}

.action-card.primary::before { background: var(--gradient-primary); }
.action-card.secondary::before { background: var(--gradient-info); }
.action-card.success::before { background: var(--gradient-success); }
.action-card.warning::before { background: var(--gradient-warning); }
.action-card.danger::before { background: var(--gradient-danger); }
.action-card.info::before { background: var(--gradient-info); }

.action-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary);
}

.action-icon {
    width: 64px;
    height: 64px;
    border-radius: var(--radius-lg);
    background: var(--gradient-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    color: white;
    box-shadow: var(--shadow-md);
    flex-shrink: 0;
}

.action-card.secondary .action-icon { background: var(--gradient-info); }
.action-card.success .action-icon { background: var(--gradient-success); }
.action-card.warning .action-icon { background: var(--gradient-warning); }
.action-card.danger .action-icon { background: var(--gradient-danger); }
.action-card.info .action-icon { background: var(--gradient-info); }

.action-content h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 0.5rem;
}

.action-content p {
    color: var(--gray-600);
    font-size: 0.875rem;
    line-height: 1.5;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: white;
    border-radius: var(--radius-xl);
    padding: 2rem;
    border: 2px solid var(--gray-100);
    box-shadow: var(--shadow-md);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-primary);
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary);
}

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.5rem;
}

.stat-header h3 {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--gray-500);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.stat-trend {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    padding: 0.5rem 0.75rem;
    border-radius: var(--radius-lg);
}

.stat-trend.positive {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.stat-trend.warning {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.stat-trend.neutral {
    background: rgba(59, 130, 246, 0.1);
    color: var(--info);
}

.stat-body {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--dark);
    line-height: 1;
}

.stat-chart canvas {
    max-width: 100px;
    height: 40px;
    opacity: 0.7;
}

/* Chart Section */
.chart-section {
    margin-bottom: 3rem;
}

.chart-container {
    background: white;
    border-radius: var(--radius-xl);
    border: 2px solid var(--gray-100);
    box-shadow: var(--shadow-md);
    overflow: hidden;
}

.chart-header {
    padding: 2rem;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
}

.chart-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dark);
}

.chart-controls {
    display: flex;
    align-items: center;
    gap: 2rem;
}

.chart-filter {
    padding: 0.75rem 1rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    background: white;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--dark);
    cursor: pointer;
    transition: var(--transition);
}

.chart-filter:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.chart-legend {
    display: flex;
    gap: 1.5rem;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--gray-600);
}

.legend-color {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    box-shadow: var(--shadow-sm);
}

.chart-body {
    padding: 2rem;
    background: white;
}

/* Table Section */
.table-section {
    margin-bottom: 2rem;
}

.table-container {
    background: white;
    border-radius: var(--radius-xl);
    border: 2px solid var(--gray-100);
    box-shadow: var(--shadow-md);
    overflow: hidden;
}

.table-header {
    padding: 2rem;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
}

.table-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dark);
}

.table-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.filter-select {
    padding: 0.75rem 1rem;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    background: white;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--dark);
    cursor: pointer;
    transition: var(--transition);
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.btn-export {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--shadow-md);
}

.btn-export:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.table-body {
    overflow-x: auto;
    background: white;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th {
    text-align: left;
    padding: 1.5rem 2rem;
    background: var(--gray-50);
    color: var(--gray-700);
    font-weight: 700;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border-bottom: 1px solid var(--gray-200);
}

td {
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--gray-100);
    color: var(--dark);
    font-weight: 500;
}

tr:hover {
    background: rgba(102, 126, 234, 0.02);
}

/* Status and Type Badges */
.status, .type-badge {
    padding: 0.5rem 1rem;
    border-radius: var(--radius-lg);
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.status.completed, .status.approved {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.status.pending {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.status.in-progress, .status.active {
    background: rgba(59, 130, 246, 0.1);
    color: var(--info);
}

.type-badge.formation {
    background: rgba(102, 126, 234, 0.1);
    color: var(--primary);
}

.type-badge.project {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.type-badge.orientation {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.type-badge.recensement {
    background: rgba(139, 92, 246, 0.1);
    color: #8b5cf6;
}

.type-badge.demande {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger);
}

/* Progress Bars */
.mini-progress {
    width: 60px;
    height: 8px;
    background: var(--gray-200);
    border-radius: 4px;
    overflow: hidden;
    margin-right: 0.5rem;
}

.progress-bar {
    height: 100%;
    background: var(--gradient-success);
    border-radius: 4px;
    transition: width 0.5s ease;
}

.progress-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--success);
}

/* Action Buttons */
.btn-mini {
    padding: 0.25rem 0.75rem;
    border: none;
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    margin-right: 0.5rem;
}

.btn-mini.view {
    background: rgba(59, 130, 246, 0.1);
    color: var(--info);
}

.btn-mini.edit {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.btn-mini.approve {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.btn-mini.reject {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger);
}

.btn-mini:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

/* Impact, Result, Action Cells */
.impact-cell, .result-cell, .action-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
}

.impact-cell {
    color: var(--success);
}

.result-cell {
    color: var(--info);
}

/* Dropdowns */
.dropdown-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(2px);
    z-index: 1998;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition);
}

.dropdown-overlay.active {
    opacity: 1;
    visibility: visible;
}

.notifications-dropdown, .user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: white;
    border-radius: var(--radius-xl);
    border: 2px solid var(--gray-200);
    box-shadow: var(--shadow-xl);
    z-index: 1999;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: var(--transition);
    overflow: hidden;
}

.notifications-dropdown.active, .user-dropdown.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.notifications-dropdown {
    width: 380px;
    max-height: 500px;
}

.user-dropdown {
    width: 280px;
}

.dropdown-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--gray-200);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
}

.dropdown-header h3 {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 0.5rem;
}

.mark-all-read {
    font-size: 0.875rem;
    color: var(--primary);
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 600;
}

.user-avatar-large {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: var(--gradient-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: var(--shadow-md);
}

.user-details h3 {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--dark);
}

.user-details p {
    font-size: 0.875rem;
    color: var(--gray-500);
}

.dropdown-body {
    padding: 1rem 0;
    max-height: 300px;
    overflow-y: auto;
}

.notification-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem 1.5rem;
    transition: var(--transition);
    position: relative;
}

.notification-item.unread {
    background: rgba(102, 126, 234, 0.05);
}

.notification-item.unread::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--primary);
}

.notification-item:hover {
    background: rgba(102, 126, 234, 0.08);
}

.notification-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--gradient-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    flex-shrink: 0;
}

.notification-content p {
    font-weight: 500;
    color: var(--dark);
    margin-bottom: 0.25rem;
    line-height: 1.4;
}

.notification-time {
    font-size: 0.75rem;
    color: var(--gray-500);
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 1.5rem;
    color: var(--dark);
    text-decoration: none;
    transition: var(--transition);
    font-weight: 500;
}

.dropdown-item:hover {
    background: rgba(102, 126, 234, 0.05);
    color: var(--primary);
}

.dropdown-item.danger {
    color: var(--danger);
}

.dropdown-item.danger:hover {
    background: rgba(239, 68, 68, 0.05);
    color: var(--danger);
}

.dropdown-divider {
    height: 1px;
    background: var(--gray-200);
    margin: 0.5rem 0;
}

.dropdown-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--gray-200);
    background: var(--gray-50);
}

.dropdown-footer a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.875rem;
    display: block;
    text-align: center;
}

/* Section Headers */
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--gray-200);
}

.section-header h2 {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--dark);
}

.section-actions {
    display: flex;
    gap: 1rem;
}

.btn-secondary {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: white;
    color: var(--primary);
    border: 2px solid var(--primary);
    border-radius: var(--radius-lg);
    text-decoration: none;
    font-weight: 600;
    transition: var(--transition);
}

.btn-secondary:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

/* Progress Content */
.progression-content {
    padding: 2rem 0;
}

.progress-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.progress-card {
    background: white;
    border-radius: var(--radius-xl);
    padding: 2rem;
    text-align: center;
    box-shadow: var(--shadow-md);
    border: 2px solid var(--gray-100);
    transition: var(--transition);
}

.progress-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary);
}

.progress-card h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 1.5rem;
}

.circular-progress {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: conic-gradient(var(--primary) calc(var(--percentage) * 3.6deg), var(--gray-200) 0deg);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    position: relative;
}

.circular-progress::before {
    content: '';
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: white;
    position: absolute;
}

.circular-progress span {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--dark);
    z-index: 1;
}

/* Stats Recenseur Content */
.stats-recenseur-content {
    padding: 2rem 0;
}

.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
}

.chart-widget {
    background: white;
    border-radius: var(--radius-xl);
    padding: 2rem;
    box-shadow: var(--shadow-md);
    border: 2px solid var(--gray-100);
}

.chart-widget h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 1.5rem;
    text-align: center;
}

/* Animations */
@keyframes pulse {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.8;
        transform: scale(1.05);
    }
}

/* Responsive Design */
@media (max-width: 1200px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .actions-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 1024px) {
    .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .sidebar.open {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 0;
    }
    
    .header-right {
        gap: 1rem;
    }
    
    .search-box input {
        width: 200px;
    }
    
    .chart-header,
    .table-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .chart-controls {
        width: 100%;
        justify-content: space-between;
    }
}

@media (max-width: 768px) {
    .content-header {
        padding: 0 1rem;
    }
    
    .content-body {
        padding: 1rem;
    }
    
    .actions-grid {
        grid-template-columns: 1fr;
    }
    
    .user-info {
        display: none;
    }
    
    .search-box {
        display: none;
    }
    
    .notifications-dropdown {
        width: 320px;
    }
    
    .user-dropdown {
        width: 240px;
    }
}

@media (max-width: 480px) {
    .dashboard-container {
        margin: -1rem;
    }
    
    .content-body {
        padding: 0.5rem;
    }
    
    .action-card {
        padding: 1.5rem;
    }
    
    .stat-card {
        padding: 1.5rem;
    }
    
    .chart-header,
    .table-header {
        padding: 1.5rem;
    }
    
    .chart-body {
        padding: 1.5rem;
    }
    
    th, td {
        padding: 1rem;
    }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Navigation
function showContent(contentId) {
    // Cacher tous les contenus
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Afficher le contenu sélectionné
    const targetSection = document.getElementById(contentId + '-content');
    if (targetSection) {
        targetSection.classList.add('active');
    } else {
        document.getElementById('dashboard-content').classList.add('active');
    }
    
    // Mettre à jour le titre et le breadcrumb
    const titles = {
        'dashboard': { title: 'DASHBOARD', breadcrumb: 'Vue d\'ensemble' },
        'progression': { title: 'MA PROGRESSION', breadcrumb: 'Formations' },
        'stats-recenseur': { title: 'STATISTIQUES', breadcrumb: 'Recensement' },
        'users-management': { title: 'GESTION UTILISATEURS', breadcrumb: 'Administration' },
        'reports': { title: 'RAPPORTS', breadcrumb: 'Analytics' }
    };
    
    const titleData = titles[contentId] || titles['dashboard'];
    document.getElementById('page-title').textContent = titleData.title;
    document.getElementById('breadcrumb-current').textContent = titleData.breadcrumb;
    
    // Mettre à jour la navigation active
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    if (event && event.target) {
        event.target.closest('.nav-item').classList.add('active');
    }
}

// Dropdowns
function toggleNotifications() {
    const dropdown = document.getElementById('notificationsDropdown');
    const overlay = document.querySelector('.dropdown-overlay');
    
    closeAllDropdowns();
    
    dropdown.classList.toggle('active');
    overlay.classList.toggle('active');
    
    event.stopPropagation();
}

function toggleUserMenu() {
    const dropdown = document.getElementById('userDropdown');
    const overlay = document.querySelector('.dropdown-overlay');
    
    closeAllDropdowns();
    
    dropdown.classList.toggle('active');
    overlay.classList.toggle('active');
    
    event.stopPropagation();
}

function closeAllDropdowns() {
    document.querySelectorAll('.notifications-dropdown, .user-dropdown').forEach(dropdown => {
        dropdown.classList.remove('active');
    });
    document.querySelector('.dropdown-overlay').classList.remove('active');
}

// Fermer dropdowns en cliquant dehors
document.addEventListener('click', closeAllDropdowns);

// Empêcher la fermeture en cliquant dans les dropdowns
document.querySelectorAll('.notifications-dropdown, .user-dropdown').forEach(dropdown => {
    dropdown.addEventListener('click', function(e) {
        e.stopPropagation();
    });
});

// Toggle sidebar pour mobile
function toggleSidebar() {
    document.querySelector('.sidebar').classList.toggle('open');
}

// Mini charts pour les stats
function createMiniChart(canvasId, data, color) {
    const ctx = document.getElementById(canvasId);
    if (!ctx) return;
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array(data.length).fill(''),
            datasets: [{
                data: data,
                borderColor: color,
                backgroundColor: color + '20',
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: { enabled: false }
            },
            scales: {
                x: { display: false },
                y: { display: false }
            },
            elements: {
                line: { borderWidth: 2 },
                point: { radius: 0 }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
}

// Graphique principal
function createMainChart() {
    const ctx = document.getElementById('mainChart');
    if (!ctx) return;
    
    {% if user.is_donator %}
    const data1 = [120, 190, 150, 250, 220, 300, 280, 350, 320, 400, 380, 450];
    const data2 = [80, 120, 100, 180, 150, 220, 200, 280, 250, 320, 300, 380];
    const label1 = 'Dons (€)';
    const label2 = 'Impact Formations';
    const color1 = '#4f46e5';
    const color2 = '#06b6d4';
    {% elif user.is_vulnerable %}
    const data1 = [2, 4, 3, 6, 5, 8, 7, 10, 9, 12, 11, 15];
    const data2 = [0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6];
    const label1 = 'Formations';
    const label2 = 'Projets';
    const color1 = '#10b981';
    const color2 = '#f59e0b';
    {% elif user.is_recenseur %}
    const data1 = [12, 14, 13, 16, 15, 18, 17, 20, 19, 22, 21, 25];
    const data2 = [8, 10, 9, 12, 11, 14, 13, 16, 15, 18, 17, 20];
    const label1 = 'Recensements';
    const label2 = 'Orientations';
    const color1 = '#8b5cf6';
    const color2 = '#06b6d4';
    {% else %}
    const data1 = [100, 120, 110, 140, 130, 160, 150, 180, 170, 200, 190, 220];
    const data2 = [80, 95, 85, 105, 95, 115, 105, 125, 115, 135, 125, 145];
    const label1 = 'Formations';
    const label2 = 'Succès';
    const color1 = '#4f46e5';
    const color2 = '#10b981';
    {% endif %}
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc'],
            datasets: [{
                label: label1,
                data: data1,
                borderColor: color1,
                backgroundColor: color1 + '20',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: color1,
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointHoverRadius: 8
            }, {
                label: label2,
                data: data2,
                borderColor: color2,
                backgroundColor: color2 + '20',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: color2,
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { 
                    display: false 
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#ffffff',
                    bodyColor: '#ffffff',
                    borderColor: '#4f46e5',
                    borderWidth: 1,
                    cornerRadius: 8,
                    displayColors: true,
                    mode: 'index',
                    intersect: false
                }
            },
            scales: {
                x: {
                    grid: { 
                        display: false 
                    },
                    ticks: { 
                        color: '#6b7280',
                        font: {
                            weight: '500'
                        }
                    },
                    border: {
                        display: false
                    }
                },
                y: {
                    grid: { 
                        color: '#f3f4f6',
                        borderDash: [5, 5]
                    },
                    ticks: { 
                        color: '#6b7280',
                        font: {
                            weight: '500'
                        }
                    },
                    border: {
                        display: false
                    }
                }
            },
            elements: {
                point: {
                    hoverBackgroundColor: '#ffffff'
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
}

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
    // Créer les mini graphiques
    createMiniChart('chart1', [12, 15, 18, 22, 25, 28, 30], '#10b981');
    createMiniChart('chart2', [8, 12, 15, 18, 20, 22, 25], '#4f46e5');
    createMiniChart('chart3', [5, 8, 12, 15, 18, 20, 22], '#06b6d4');
    
    // Créer le graphique principal
    createMainChart();
    
    // Initialiser les progress circulaires
    document.querySelectorAll('.circular-progress').forEach(progress => {
        const percentage = progress.dataset.percentage || 0;
        progress.style.setProperty('--percentage', percentage);
    });
    
    // Animation des cartes stats au scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observer les éléments animés
    document.querySelectorAll('.stat-card, .action-card, .chart-container, .table-container').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'all 0.6s ease-out';
        observer.observe(el);
    });
    
    // Auto-refresh des statistiques toutes les 5 minutes
    setInterval(updateDashboardStats, 300000);
    
    // Initialiser les tooltips et animations
    initializeTooltips();
    initializeAnimations();
});

// Mise à jour des statistiques
function updateDashboardStats() {
    fetch('/users/api/dashboard-stats/')
        .then(response => response.json())
        .then(data => {
            // Mettre à jour les valeurs des stats
            Object.keys(data).forEach(key => {
                const elements = document.querySelectorAll(`[data-stat="${key}"]`);
                elements.forEach(el => {
                    if (el) {
                        const currentValue = parseInt(el.textContent) || 0;
                        const newValue = data[key];
                        animateValue(el, currentValue, newValue, 1000);
                    }
                });
            });
        })
        .catch(error => console.log('Erreur refresh stats:', error));
}

// Animation des valeurs numériques
function animateValue(element, start, end, duration) {
    const startTime = performance.now();
    const difference = end - start;
    
    function updateValue(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Easing function (ease-out)
        const easeProgress = 1 - Math.pow(1 - progress, 3);
        const current = Math.floor(start + (difference * easeProgress));
        
        element.textContent = current;
        
        if (progress < 1) {
            requestAnimationFrame(updateValue);
        } else {
            element.textContent = end;
        }
    }
    
    requestAnimationFrame(updateValue);
}

// Initialiser les tooltips
function initializeTooltips() {
    document.querySelectorAll('[data-tooltip]').forEach(element => {
        element.addEventListener('mouseenter', function(e) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = this.dataset.tooltip;
            document.body.appendChild(tooltip);
            
            const rect = this.getBoundingClientRect();
            tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
            tooltip.style.top = rect.top - tooltip.offsetHeight - 10 + 'px';
            
            setTimeout(() => tooltip.classList.add('visible'), 10);
        });
        
        element.addEventListener('mouseleave', function() {
            document.querySelectorAll('.tooltip').forEach(tooltip => {
                tooltip.classList.remove('visible');
                setTimeout(() => tooltip.remove(), 300);
            });
        });
    });
}

// Initialiser les animations
function initializeAnimations() {
    // Animation des progress bars
    document.querySelectorAll('.progress-bar').forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });
    
    // Animation des badges
    document.querySelectorAll('.badge').forEach(badge => {
        if (parseInt(badge.textContent) > 0) {
            badge.style.animation = 'pulse 2s infinite';
        }
    });
}

// Gestion des filtres de graphique
document.addEventListener('change', function(e) {
    if (e.target.classList.contains('chart-filter')) {
        updateChartData(e.target.value);
    }
});

function updateChartData(period) {
    // Logique pour mettre à jour les données du graphique selon la période
    console.log('Mise à jour graphique pour période:', period);
    // Ici vous pouvez faire un appel API pour récupérer les nouvelles données
}

// Gestion des exports
document.addEventListener('click', function(e) {
    if (e.target.closest('.btn-export')) {
        exportTableData();
    }
});

function exportTableData() {
    // Logique d'export
    console.log('Export des données du tableau');
    // Ici vous pouvez implémenter l'export CSV/Excel
}

// Notifications temps réel (WebSocket optionnel)
function initializeWebSocket() {
    if ('WebSocket' in window) {
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const ws = new WebSocket(`${protocol}//${window.location.host}/ws/dashboard/`);
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            handleRealTimeUpdate(data);
        };
        
        ws.onclose = function() {
            // Reconnexion automatique après 5 secondes
            setTimeout(initializeWebSocket, 5000);
        };
    }
}

function handleRealTimeUpdate(data) {
    // Mettre à jour l'interface en temps réel
    if (data.type === 'notification') {
        showNotification(data.message);
        updateNotificationBadge(data.count);
    } else if (data.type === 'stats_update') {
        updateDashboardStats();
    }
}

// Affichage des notifications
function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'toast-notification';
    notification.innerHTML = `
        <div class="toast-icon">
            <i class="fas fa-bell"></i>
        </div>
        <div class="toast-content">
            <p>${message}</p>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('visible'), 100);
    setTimeout(() => {
        notification.classList.remove('visible');
        setTimeout(() => notification.remove(), 300);
    }, 5000);
}

function updateNotificationBadge(count) {
    const badge = document.querySelector('.notification-dot');
    if (badge) {
        badge.textContent = count;
        badge.style.display = count > 0 ? 'flex' : 'none';
    }
}

// Raccourcis clavier
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + K pour focus sur la recherche
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.querySelector('.search-box input').focus();
    }
    
    // Echap pour fermer les dropdowns
    if (e.key === 'Escape') {
        closeAllDropdowns();
    }
});

// Gestion du mode hors ligne
window.addEventListener('online', function() {
    showNotification('Connexion rétablie');
    updateDashboardStats();
});

window.addEventListener('offline', function() {
    showNotification('Mode hors ligne activé');
});

// Performance monitoring
function logPerformance() {
    if ('performance' in window) {
        const navigation = performance.getEntriesByType('navigation')[0];
        console.log('Temps de chargement:', navigation.loadEventEnd - navigation.loadEventStart, 'ms');
    }
}

// Initialiser le monitoring après le chargement complet
window.addEventListener('load', logPerformance);

// Cleanup et optimisations
window.addEventListener('beforeunload', function() {
    // Nettoyer les timers et WebSockets
    clearInterval(window.dashboardRefreshInterval);
    if (window.dashboardWebSocket) {
        window.dashboardWebSocket.close();
    }
});
</script>

<!-- Styles pour les tooltips et notifications -->
<style>
.tooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    z-index: 10000;
    opacity: 0;
    transform: translateY(5px);
    transition: all 0.3s ease;
    pointer-events: none;
    white-space: nowrap;
}

.tooltip.visible {
    opacity: 1;
    transform: translateY(0);
}

.toast-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    border: 1px solid var(--gray-200);
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    min-width: 300px;
    z-index: 10001;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
}

.toast-notification.visible {
    opacity: 1;
    transform: translateX(0);
}

.toast-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--gradient-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.toast-content p {
    margin: 0;
    font-weight: 500;
    color: var(--dark);
}

.toast-close {
    background: none;
    border: none;
    color: var(--gray-400);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: var(--transition);
}

.toast-close:hover {
    background: var(--gray-100);
    color: var(--gray-600);
}

/* Responsive pour mobile */
@media (max-width: 768px) {
    .toast-notification {
        right: 10px;
        left: 10px;
        min-width: auto;
    }
}

/* Animation loading pour les cartes */
.loading-skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* Scrollbar personnalisée */
.sidebar::-webkit-scrollbar,
.dropdown-body::-webkit-scrollbar {
    width: 6px;
}

.sidebar::-webkit-scrollbar-track,
.dropdown-body::-webkit-scrollbar-track {
    background: var(--gray-100);
    border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb,
.dropdown-body::-webkit-scrollbar-thumb {
    background: var(--gray-300);
    border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover,
.dropdown-body::-webkit-scrollbar-thumb:hover {
    background: var(--gray-400);
}

/* Focus indicators pour l'accessibilité */
.nav-item:focus,
.action-card:focus,
.btn-export:focus,
.search-box input:focus {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

/* Print styles */
@media print {
    .sidebar,
    .content-header,
    .quick-actions,
    .dropdown-overlay,
    .notifications-dropdown,
    .user-dropdown,
    .toast-notification {
        display: none !important;
    }
    
    .main-content {
        margin-left: 0;
    }
    
    .content-body {
        padding: 0;
    }
    
    .stat-card,
    .chart-container,
    .table-container {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid var(--gray-300);
    }
}
</style>

{% endblock %}